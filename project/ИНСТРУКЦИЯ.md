# Инструкция по исправлению ошибок и инициализации базы данных

## Проблема с инициализацией базы данных

Если вы столкнулись с ошибками при инициализации базы данных в проекте, выполните следующие шаги:

### Шаг 1: Установка зависимостей

Проект использует несколько основных библиотек Python. В случае конфликта версий рекомендуется использовать следующие команды:

```bash
# Активируйте виртуальное окружение (если используете)
# В Windows:
venv\Scripts\activate

# Обновите pip
python -m pip install --upgrade pip

# Установите зависимости напрямую (без requirements.txt)
pip install flask>=2.2 flask-sqlalchemy>=3.0 sqlalchemy>=2.0
```

### Шаг 2: Инициализация базы данных без Flask

Для наиболее надежного варианта инициализации базы данных используйте скрипт, который не зависит от Flask:

```bash
# Находясь в директории project
python no_flask_init_db.py
```

Этот скрипт:
1. Удалит поврежденную базу данных (если она существует)
2. Создаст новую базу данных SQLite
3. Применит схему таблиц из файла schema.sql
4. Создаст необходимые триггеры

### Шаг 3: Добавление тестовых данных

После успешной инициализации базы данных добавьте тестовые данные:

```bash
# Находясь в директории project
python test_db.py
```

Это добавит:
- Тестового пользователя (admin@example.com / admin123)
- Тестовый курс с модулем

### Шаг 4: Запуск приложения

После успешной инициализации базы данных запустите приложение:

```bash
# Находясь в директории project
python run.py
```

## Решение распространенных ошибок

### Ошибка: "file is not a database"

Решение: База данных повреждена. Запустите скрипт `no_flask_init_db.py`, который удалит поврежденную базу данных и создаст новую.

### Ошибка: "flask не является внутренней или внешней командой"

Решение: Flask не установлен или не доступен в переменных среды. Используйте скрипт `no_flask_init_db.py` вместо команд Flask.

### Ошибка: "module 'sqlalchemy' has no attribute '__all__'"

Решение: Конфликт версий SQLAlchemy. Установите совместимые версии:
```bash
pip install flask>=2.2 flask-sqlalchemy>=3.0 sqlalchemy>=2.0
```

### Ошибка: "Cannot install -r requirements.txt ... conflicting dependencies"

Решение: Конфликт версий в requirements.txt. Установите зависимости напрямую:
```bash
pip install flask>=2.2 flask-sqlalchemy>=3.0 sqlalchemy>=2.0 flask-bcrypt flask-jwt-extended flask-migrate flask-cors
```

## Дополнительные скрипты для работы с базой данных

В проекте есть несколько скриптов для работы с базой данных:

1. **no_flask_init_db.py** - Создание базы данных без зависимостей от Flask (рекомендуется)
2. **test_db.py** - Тестирование базы данных и добавление тестовых данных
3. **init_db.py** - Инициализация через Flask API (может вызывать ошибки)
4. **create_db_direct.py** - Альтернативный скрипт для прямого создания базы данных

## Структура проекта

- **/project** - Корневая директория проекта
  - **/app** - Модули Flask-приложения
  - **/instance** - Директория с базой данных
  - **/sql** - SQL-скрипты схемы и запросов
